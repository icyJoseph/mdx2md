<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <title>mdx2md · HTML → Markdown</title>
    <meta
      name="description"
      content="Convert HTML to clean Markdown via mdx2md component templates. Built in Rust, runs in the browser via WASM."
    />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --bg: #0d1117;
        --bg-surface: #161b22;
        --bg-input: #0d1117;
        --border: #30363d;
        --text: #e6edf3;
        --text-muted: #8b949e;
        --accent: #a371f7;
        --error: #f85149;
        --font-mono:
          "SF Mono", "Cascadia Code", "Fira Code", "JetBrains Mono", monospace;
        --font-sans:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial,
          sans-serif;
      }

      html,
      body {
        height: 100%;
      }

      body {
        font-family: var(--font-sans);
        background: var(--bg);
        color: var(--text);
        display: flex;
        flex-direction: column;
      }

      header {
        padding: 12px 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 16px;
        flex-shrink: 0;
      }

      header h1 {
        font-size: 18px;
        font-weight: 600;
        letter-spacing: -0.02em;
      }

      header h1 span {
        color: var(--accent);
        font-weight: 400;
      }

      .nav-link {
        font-size: 12px;
        color: var(--text-muted);
        text-decoration: none;
        transition: color 0.15s;
      }

      .nav-link:hover {
        color: var(--text);
        text-decoration: underline;
      }

      #status {
        font-size: 12px;
        color: var(--text-muted);
        margin-left: auto;
      }

      #status.ready {
        color: #3fb950;
      }
      #status.error {
        color: var(--error);
      }

      .github-link {
        color: var(--text-muted);
        text-decoration: none;
        display: flex;
        align-items: center;
        transition: color 0.15s;
      }

      .github-link:hover {
        color: var(--text);
      }

      .panes {
        flex: 1;
        display: grid;
        grid-template-columns: 1fr 1fr;
        min-height: 0;
      }

      .pane {
        display: flex;
        flex-direction: column;
        min-height: 0;
        border-right: 1px solid var(--border);
      }

      .pane:last-child {
        border-right: none;
      }

      .pane-header {
        padding: 8px 16px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--text-muted);
        background: var(--bg-surface);
        border-bottom: 1px solid var(--border);
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .pane-body {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      textarea,
      .output-area {
        flex: 1;
        width: 100%;
        min-height: 0;
        padding: 16px;
        font-family: var(--font-mono);
        font-size: 13px;
        line-height: 1.6;
        background: var(--bg-input);
        color: var(--text);
        border: none;
        resize: none;
        outline: none;
        tab-size: 2;
      }

      textarea::placeholder {
        color: var(--text-muted);
      }

      .output-area {
        overflow: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .right-pane {
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .output-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-height: 60px;
        overflow: hidden;
      }

      .resize-handle {
        height: 6px;
        background: var(--bg-surface);
        border-top: 1px solid var(--border);
        border-bottom: 1px solid var(--border);
        cursor: row-resize;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .resize-handle::after {
        content: "";
        width: 32px;
        height: 2px;
        background: var(--text-muted);
        border-radius: 1px;
        opacity: 0.5;
      }

      .resize-handle:hover::after,
      .resize-handle.dragging::after {
        opacity: 1;
        background: var(--accent);
      }

      .config-section {
        flex-shrink: 0;
        display: flex;
        flex-direction: column;
        min-height: 0;
        overflow: hidden;
      }

      .config-section.collapsed {
        height: auto !important;
      }
      .config-section.collapsed .pane-body {
        display: none;
      }
      .config-section.collapsed + .resize-handle,
      .config-section.collapsed ~ .resize-handle {
        display: none;
      }

      .config-section .pane-body {
        flex: 1;
        min-height: 0;
      }

      .config-section textarea {
        height: 100%;
        flex: 1;
        font-size: 12px;
      }

      .toggle-btn {
        background: none;
        border: none;
        color: var(--accent);
        font-size: 11px;
        cursor: pointer;
        padding: 0;
        font-family: var(--font-sans);
      }

      .toggle-btn:hover {
        text-decoration: underline;
      }

      #error-bar {
        padding: 8px 16px;
        font-size: 12px;
        font-family: var(--font-mono);
        color: var(--error);
        background: #f8514922;
        border-top: 1px solid var(--error);
        display: none;
        flex-shrink: 0;
      }

      #error-bar.visible {
        display: block;
      }

      @media (max-width: 768px) {
        .panes {
          grid-template-columns: 1fr;
          grid-template-rows: 1fr 1fr;
        }
        .pane {
          border-right: none;
          border-bottom: 1px solid var(--border);
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>mdx2md <span>html → md</span></h1>
      <a class="nav-link" href="./index.html">playground</a>
      <a class="nav-link" href="./html-md.html">html → md</a>
      <a class="nav-link" href="./sanitize.html">sanitize</a>
      <a
        class="github-link"
        href="https://github.com/icyjoseph/mdx2md"
        target="_blank"
        rel="noopener noreferrer"
        title="View on GitHub"
      >
        <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor">
          <path
            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0016 8c0-4.42-3.58-8-8-8z"
          />
        </svg>
      </a>
      <span id="status">Loading WASM...</span>
    </header>

    <div class="panes">
      <div class="pane">
        <div class="pane-header">HTML Input</div>
        <div class="pane-body">
          <textarea
            id="input"
            spellcheck="false"
            placeholder="Paste HTML here..."
          ></textarea>
        </div>
      </div>

      <div class="pane right-pane">
        <div class="output-section">
          <div class="pane-header">Markdown Output</div>
          <div class="pane-body">
            <div class="output-area" id="output"></div>
          </div>
          <div id="error-bar"></div>
        </div>

        <div class="resize-handle" id="resize-handle"></div>

        <div class="config-section" id="config-section">
          <div class="pane-header">
            Config
            <button class="toggle-btn" id="config-toggle">collapse</button>
          </div>
          <div class="pane-body">
            <textarea id="config-input" spellcheck="false"></textarea>
          </div>
        </div>
      </div>
    </div>

    <script type="module">
      import init, { convert } from "./mdx2md_wasm.js";

      const inputEl = document.getElementById("input");
      const outputEl = document.getElementById("output");
      const configInput = document.getElementById("config-input");
      const errorBar = document.getElementById("error-bar");
      const status = document.getElementById("status");
      const configSection = document.getElementById("config-section");
      const configToggle = document.getElementById("config-toggle");
      const resizeHandle = document.getElementById("resize-handle");

      inputEl.value = `<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Getting Started with mdx2md</title>
    <meta name="description" content="A guide to mdx2md" />
    <link rel="stylesheet" href="/styles.css" />
    <style>body { font-family: sans-serif; }</style>
    <script>console.log("hello");<\/script>
  </head>
  <body>
    <nav>
      <a href="/">Home</a>
      <a href="/docs">Docs</a>
    </nav>

    <main>
      <h1>Getting Started</h1>
      <p>This is a <strong>paragraph</strong> with <em>emphasis</em> and <code>inline code</code>.</p>

      <h2>Installation</h2>
      <pre><code class="language-bash">npm install mdx2md</code></pre>

      <blockquote>
        <p>This library is <strong>fast</strong> and runs in the browser via WASM.</p>
      </blockquote>

      <h2>Features</h2>
      <ul>
        <li>MDX to Markdown conversion</li>
        <li>Configurable component templates</li>
        <li>Link and image rewriting</li>
      </ul>

      <h2>Comparison</h2>
      <table>
        <tr><th>Feature</th><th>mdx2md</th><th>Other</th></tr>
        <tr><td>WASM</td><td>Yes</td><td>No</td></tr>
        <tr><td>Config-driven</td><td>Yes</td><td>Partial</td></tr>
      </table>

      <h2>Links</h2>
      <p>Check the <a href="https://github.com/icyjoseph/mdx2md">repo</a> and
        the <a href="https://docs.example.com">docs</a>.</p>

      <p>Here is an image: <img src="/logo.png" alt="Logo" /></p>

      <hr />

      <h2>Ordered Steps</h2>
      <ol>
        <li>Clone the repo</li>
        <li>Run <code>cargo build</code></li>
        <li>Try the playground</li>
      </ol>
    </main>

    <footer>
      <p>&copy; 2025 mdx2md</p>
    </footer>
  </body>
</html>`;

      const DEFAULT_CONFIG = {
        stripImports: true,
        stripExports: true,
        preserveFrontmatter: false,
        expressionHandling: "strip",
        components: {
          // Document structure — drop head, pass body
          html: "{children}",
          head: "",
          body: "{children}",
          meta: "",
          title: "",
          link: "",
          script: "",
          style: "",

          // Layout — pass through children
          main: "{children}",
          article: "{children}",
          section: "{children}",
          div: "{children}",
          span: "{children}",
          header: "{children}",
          footer: "{children}",
          nav: "{children}",

          // Block elements
          h1: "# {children}\n",
          h2: "## {children}\n",
          h3: "### {children}\n",
          h4: "#### {children}\n",
          h5: "##### {children}\n",
          h6: "###### {children}\n",
          p: "{children}\n",
          blockquote: "> {children}",
          pre: "```\\n{children}\\n```\\n",
          hr: "---\\n",

          // Inline elements
          strong: "**{children}**",
          b: "**{children}**",
          em: "*{children}*",
          i: "*{children}*",
          code: "`{children}`",
          a: "[{children}]({href})",
          img: "![{alt}]({src})",
          br: "\\n",

          // Lists
          ul: "{children}",
          ol: "{children}",
          li: "- {children}\n",

          // Fallback
          _default: "{children}",
        },
      };

      configInput.value = JSON.stringify(DEFAULT_CONFIG, null, 2);
      configSection.style.height = "40%";

      configToggle.addEventListener("click", () => {
        const collapsed = configSection.classList.toggle("collapsed");
        configToggle.textContent = collapsed ? "expand" : "collapse";
        resizeHandle.style.display = collapsed ? "none" : "";
        if (!collapsed) configSection.style.height = "40%";
      });

      let dragging = false;
      resizeHandle.addEventListener("mousedown", (e) => {
        e.preventDefault();
        dragging = true;
        resizeHandle.classList.add("dragging");
        document.body.style.cursor = "row-resize";
        document.body.style.userSelect = "none";
      });

      window.addEventListener("mousemove", (e) => {
        if (!dragging) return;
        const rect = configSection.parentElement.getBoundingClientRect();
        const h = Math.max(
          48,
          Math.min(rect.height - 100, rect.bottom - e.clientY),
        );
        configSection.style.height = h + "px";
      });

      window.addEventListener("mouseup", () => {
        if (!dragging) return;
        dragging = false;
        resizeHandle.classList.remove("dragging");
        document.body.style.cursor = "";
        document.body.style.userSelect = "";
      });

      let debounceTimer;
      function scheduleConvert() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(runConvert, 150);
      }

      function runConvert() {
        const html = inputEl.value;
        let options;

        try {
          options = JSON.parse(configInput.value);
        } catch (e) {
          showError("Config JSON error: " + e.message);
          return;
        }

        try {
          const result = convert(html, options);
          outputEl.textContent = result;
          hideError();
        } catch (e) {
          showError(e.message || String(e));
        }
      }

      function showError(msg) {
        errorBar.textContent = msg;
        errorBar.classList.add("visible");
      }

      function hideError() {
        errorBar.classList.remove("visible");
      }

      inputEl.addEventListener("input", scheduleConvert);
      configInput.addEventListener("input", scheduleConvert);

      try {
        await init();
        status.textContent = "Ready";
        status.className = "ready";
        runConvert();
      } catch (e) {
        status.textContent = "Failed to load WASM";
        status.className = "error";
        showError("WASM init failed: " + (e.message || String(e)));
      }
    </script>
  </body>
</html>
